
#--------------------------
# Variables
#--------------------------

 MAKE                 = make -s
 CC                   = @CC@
 SOURCE_PATH          = ./
 EXPAND_DIR           = @prefix@
 OBJECTS_XPN_SERVER   = @top_srcdir@/src/xpn_server/xpn_server.o \
			@top_srcdir@/src/xpn_server/xpn_server_params.o \
			@top_srcdir@/src/xpn_server/xpn_server_comm.o \
			@top_srcdir@/src/xpn_server/xpn_server_ops.o \
			@top_srcdir@/src/xpn_server/mpi_server/mpi_server_comm.o \
			@top_srcdir@/src/xpn_server/sck_server/sck_server_comm.o \
			@top_srcdir@/src/base/filesystem.o \
			@top_srcdir@/src/base/urlstr.o \
			@top_srcdir@/src/base/string_misc.o \
			@top_srcdir@/src/base/debug_msg.o \
			@top_srcdir@/src/base/utils.o \
			@top_srcdir@/src/base/time_misc.o \
			@top_srcdir@/src/base/ns.o \
			@top_srcdir@/src/base/workers.o \
			@top_srcdir@/src/base/workers_ondemand.o \
			@top_srcdir@/src/base/workers_pool.o
MYFLAGS              = -g  -Wall -Wextra -static -std=c11 @CDEFS@ -D_REENTRANT -DPOSIX_THREADS -DHAVE_CONFIG_H -D_GNU_SOURCE -DHAVE_STRUCT_IOVEC
MYHEADERS            = -I. -I$(EXPAND_DIR)/include -I../../include -I../../include/base -I../../include/xpn_client -I../../include/xpn_server  -I../../include/xpn_server/mpi_server  -I../../include/xpn_server/sck_server
MYLIBS               =  -L../../src/xpn_client -lxpn @LIBS@

XPN_SERVER_EXE       = xpn_server
XPN_SERVER_EXE_STOP  = xpn_stop_server
XPN_SERVER_EXE_TERMINATE  = xpn_terminate_server


#--------------------------
# Compilation rules
#--------------------------


all:  all_object  all_exe

all_object:  $(OBJECTS_XPN_SERVER)

all_exe:  $(XPN_SERVER_EXE) $(XPN_SERVER_EXE_STOP)  $(XPN_SERVER_EXE_TERMINATE)

%.o: %.c
	$(CC) $(MYFLAGS) $(MYHEADERS) -c $< -o $@

$(XPN_SERVER_EXE): $(OBJECTS_XPN_SERVER)
	$(CC) -o $(XPN_SERVER_EXE)  $(OBJECTS_XPN_SERVER)  $(MYLIBS)

$(XPN_SERVER_EXE_STOP): $(XPN_SERVER_EXE)
	ln -s $(XPN_SERVER_EXE) $(XPN_SERVER_EXE_STOP)

$(XPN_SERVER_EXE_TERMINATE): $(XPN_SERVER_EXE)
	ln -s $(XPN_SERVER_EXE) $(XPN_SERVER_EXE_TERMINATE)

install:  $(XPN_SERVER_EXE)
	cp -a                   $(XPN_SERVER_EXE) $(EXPAND_DIR)/bin
	rm -fr $(EXPAND_DIR)/bin/$(XPN_SERVER_EXE_STOP) && ln -s $(EXPAND_DIR)/bin/$(XPN_SERVER_EXE) $(EXPAND_DIR)/bin/$(XPN_SERVER_EXE_STOP)
	rm -fr $(EXPAND_DIR)/bin/$(XPN_SERVER_EXE_TERMINATE) && ln -s $(EXPAND_DIR)/bin/$(XPN_SERVER_EXE) $(EXPAND_DIR)/bin/$(XPN_SERVER_EXE_TERMINATE)


clean:
	rm -f $(OBJECTS_XPN_SERVER)
	rm -f $(XPN_SERVER_EXE)
	rm -f $(XPN_SERVER_EXE_STOP)
	rm -f $(XPN_SERVER_EXE_TERMINATE)

